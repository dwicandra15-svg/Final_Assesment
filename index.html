<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Aplikasi Ujian Online - Final Assessment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f3f4f6;
      color: #111827;
    }
    header {
      background: #1f2937;
      color: #fff;
      padding: 14px 16px;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 22px;
    }
    header .subtitle {
      margin-top: 4px;
      font-size: 13px;
      opacity: 0.9;
    }
    main {
      max-width: 1000px;
      margin: 16px auto;
      padding: 16px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .nav {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .nav button {
      flex: 1;
      padding: 8px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      background: #e5e7eb;
      color: #111827;
    }
    .nav button.button_active {
      background: #2563eb;
      color: #fff;
    }

    h2, h3, h4 { margin-top: 0; }
    .section { display: none; }
    .section.active { display: block; }

    .card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 12px;
      background: #f9fafb;
    }

    label {
      display: block;
      margin-top: 6px;
      margin-bottom: 2px;
      font-size: 13px;
    }
    input[type=text],
    input[type=password],
    input[type=number],
    textarea,
    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 13px;
    }
    textarea { resize: vertical; min-height: 60px; }

    .btn {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
    }
    .btn-primary { background: #2563eb; color: #fff; }
    .btn-secondary { background: #6b7280; color: #fff; }
    .btn-danger { background: #dc2626; color: #fff; }
    .btn-sm { padding: 4px 10px; font-size: 12px; }

    .info-box {
      margin-top: 6px;
      padding: 8px 10px;
      border-radius: 6px;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #1e3a8a;
      font-size: 13px;
    }

    .flex {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .flex-1 { flex: 1; min-width: 260px; }
    .flex-2 { flex: 2; min-width: 320px; }

    .question-card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      background: #fff;
    }
    .choices .choice {
      margin-top: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-top: 8px;
    }
    th, td {
      border: 1px solid #d1d5db;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #111827;
      color: #fff;
    }
    tr:nth-child(even) td { background: #f9fafb; }

    .kop {
      text-align: center;
      margin-bottom: 8px;
    }
    .kop-title { font-weight: bold; font-size: 16px; }
    .kop-subtitle { font-size: 13px; }

    .hidden { display: none; }
    .mt-2 { margin-top: 8px; }
    .mt-3 { margin-top: 12px; }
    .mt-4 { margin-top: 16px; }

    .alert {
      background: #fef3c7;
      border: 1px solid #fbbf24;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      margin-top: 6px;
    }

    .watermark-global {
      max-width: 1000px;
      margin: 6px auto 16px;
      text-align: center;
      font-size: 12px;
      color: #6b7280;
      border-top: 1px solid #e5e7eb;
      padding-top: 6px;
      font-style: italic;
    }

    @media print {
      body * { visibility: hidden; }
      #daftarNilaiArea, #daftarNilaiArea * { visibility: visible; }
      #daftarNilaiArea {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        margin: 0;
        padding: 0;
        box-shadow: none;
        border: none;
      }
      .watermark-global { display: none !important; }
    }
  </style>
</head>
<body>
<header>
  <h1>Aplikasi Ujian Online</h1>
  <div id="headerSubtitle" class="subtitle">
    Final Assessment Ujian Online
  </div>
</header>

<main>
  <div class="nav">
    <button id="btnModeSiswa" class="button_active">Mode Siswa</button>
    <button id="btnModeGuru">Mode Guru</button>
    <button id="btnModeRekap">Rekap Nilai</button>
  </div>

  <!-- MODE SISWA -->
  <section id="sectionSiswa" class="section active">
    <div class="card">
      <h2>Ujian Online - Siswa</h2>
      <p style="font-size:13px;margin:4px 0;">
        Ujian aktif: <b><span id="examNameViewSiswa">Belum diatur</span></b>,
        durasi <span id="examDurationViewSiswa">0</span> menit.
      </p>
      <div class="info-box">
        Isikan nama, kelas, dan kode ujian dari guru, lalu klik
        <b>Mulai Ujian</b>.
      </div>
      <label>Nama Siswa</label>
      <input type="text" id="siswaNama" />
      <label>Kelas</label>
      <input type="text" id="siswaKelas" />
      <label>Kode Ujian</label>
      <input type="text" id="siswaExamCode" />
      <button class="btn btn-primary mt-3" id="btnMulaiUjian">Mulai Ujian</button>
    </div>

    <div id="ujianArea" class="card hidden">
      <div class="flex" style="justify-content:space-between;align-items:center;">
        <h3>Soal Pilihan Ganda</h3>
        <div id="timerArea" class="hidden">
          <b>Sisa waktu:</b> <span id="timerText">--:--</span>
        </div>
      </div>
      <div id="soalContainer" class="mt-2"></div>
      <button class="btn btn-primary mt-3" id="btnSelesaiUjian">Selesai &amp; Lihat Nilai</button>
      <div id="peringatanFocus" class="alert hidden">
        Sistem mendeteksi perpindahan jendela/tab. Harap fokus di halaman ujian.
      </div>
    </div>

    <div id="hasilArea" class="card hidden">
      <h3>Hasil Ujian</h3>
      <p><b>Nama:</b> <span id="hasilNama"></span></p>
      <p><b>Kelas:</b> <span id="hasilKelas"></span></p>
      <p><b>Skor:</b> <span id="hasilSkor"></span></p>
      <p><b>Predikat:</b> <span id="hasilPredikat"></span></p>
      <p><b>Status:</b> <span id="hasilStatus"></span></p>
      <button class="btn btn-primary mt-2" id="btnDownloadNilai">Download Nilai (Excel/CSV)</button>
    </div>
  </section>

  <!-- LOGIN GURU -->
  <section id="sectionGuruLogin" class="section">
    <div class="card">
      <h2>Login Guru (Admin)</h2>
      <div class="info-box">
        Login menggunakan email &amp; password yang sudah didaftarkan di Firebase Authentication.
      </div>
      <label>Email</label>
      <input type="text" id="adminUser" />
      <label>Password</label>
      <input type="password" id="adminPass" />
      <button class="btn btn-primary mt-2" id="btnLoginGuru">Login</button>
      <div id="loginError" class="alert hidden"></div>
    </div>
  </section>

  <!-- PANEL GURU -->
  <section id="sectionGuruPanel" class="section">
    <div class="card">
      <div class="flex" style="justify-content:space-between;align-items:center;">
        <div>
          <h2>Panel Guru / Admin</h2>
          <div id="adminInfoText" style="font-size:12px;color:#4b5563;">
            Belum login.
          </div>
        </div>
        <button class="btn btn-secondary btn-sm" id="btnLogoutGuru">Logout</button>
      </div>
      <div class="info-box">
        Ujian dan bank soal disimpan di Firestore per kode ujian. Guru lain tidak dapat menimpa ujian guru ini.
      </div>
    </div>

    <div class="flex">
      <!-- Pengaturan ujian + kop -->
      <div class="flex-1">
        <div class="card">
          <h3>Pengaturan Ujian</h3>
          <label>Nama Ujian / Mapel</label>
          <input type="text" id="examNameInput" placeholder="Ujian Contoh" />
          <label>Kode Ujian</label>
          <input type="text" id="examCodeInput" placeholder="1234" />
          <label>Durasi Ujian (menit)</label>
          <input type="number" id="examDurationInput" min="1" value="60" />

          <label style="margin-top:6px;">
            <input type="checkbox" id="shuffleQuestionsCheckbox" checked />
            Acak urutan soal
          </label>

          <button class="btn btn-primary mt-2" id="btnSimpanUjian">Simpan Pengaturan (Lokal)</button>
          <button class="btn btn-secondary mt-2" id="btnLoadExamDb">Ambil dari Database</button>
          <button class="btn btn-primary mt-2" id="btnSaveExamDb">Simpan Ujian + Soal ke Database</button>
        </div>

        <div class="card">
          <h3>Pengaturan Header</h3>
          <label>Subjudul Header</label>
          <input type="text" id="headerSubtitleInput" placeholder="Final Assessment Ujian Online" />
          <button class="btn btn-primary mt-2" id="btnSimpanHeader">Simpan Header</button>
        </div>

        <div class="card">
          <h3>Pengaturan Kop Daftar Nilai</h3>
          <label>Judul Kop</label>
          <input type="text" id="kopTitle" placeholder="DAFTAR NILAI SISWA ASSESMENT KNOWLEDGE" />
          <label>Sub Judul</label>
          <input type="text" id="kopSubtitle" placeholder="SMP NEGERI 6 SAMPANG" />
          <button class="btn btn-primary mt-2" id="btnSimpanKop">Simpan Kop</button>
        </div>
      </div>

      <!-- Bank soal -->
      <div class="flex-2">
        <div class="card">
          <h3>Kelola Soal Ujian</h3>
          <div class="question-card">
            <h4 id="formSoalTitle">Tambah Soal Baru</h4>
            <input type="hidden" id="editIndex" value="-1" />
            <label>Pertanyaan</label>
            <textarea id="soalText"></textarea>
            <label>Pilihan 1</label>
            <input type="text" id="pilihan1" />
            <label>Pilihan 2</label>
            <input type="text" id="pilihan2" />
            <label>Pilihan 3</label>
            <input type="text" id="pilihan3" />
            <label>Pilihan 4</label>
            <input type="text" id="pilihan4" />
            <label>Jawaban Benar</label>
            <select id="jawabanBenar">
              <option value="0">Pilihan 1</option>
              <option value="1">Pilihan 2</option>
              <option value="2">Pilihan 3</option>
              <option value="3">Pilihan 4</option>
            </select>
            <label>Skor Soal</label>
            <input type="number" id="skorSoal" value="1" min="1" />
            <button class="btn btn-primary mt-2" id="btnSimpanSoal">Simpan Soal</button>
            <button class="btn btn-secondary mt-2 hidden" id="btnBatalEdit">Batal Edit</button>
          </div>

          <div class="mt-2">
            <button class="btn btn-secondary btn-sm" id="btnDownloadBankSoal">Download Bank Soal (JSON)</button>
            <input type="file" id="uploadBankSoal" accept=".json" />
          </div>

          <h4 class="mt-3">Daftar Soal</h4>
          <table id="tabelSoal">
            <thead>
              <tr>
                <th>No</th>
                <th>Soal</th>
                <th>Skor</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Rekap di panel guru -->
    <div class="card mt-3">
      <h3>Rekap Nilai (Upload CSV / Otomatis)</h3>
      <p style="font-size:13px;">
        Format CSV: <b>Nama, Kelas, Predikat, Score, Status</b>.<br/>
        Nilai juga bisa dimuat otomatis dari database (Firestore).
      </p>
      <div class="flex">
        <div class="flex-1">
          <input type="file" id="fileNilai" accept=".csv" />
        </div>
        <div class="flex-1">
          <button class="btn btn-primary" id="btnTampilkanDaftarSiswa">Tampilkan Daftar Siswa (CSV)</button>
        </div>
      </div>

      <div class="flex mt-2">
        <div class="flex-1">
          <label>Filter Nama</label>
          <input type="text" id="filterNama" placeholder="Cari nama..." />
        </div>
        <div class="flex-1">
          <label>Filter Kelas</label>
          <input type="text" id="filterKelas" placeholder="Cari kelas..." />
        </div>
      </div>

      <div class="mt-3" id="daftarNilaiArea">
        <div class="kop">
          <div class="kop-title" id="kopTitleView">DAFTAR NILAI SISWA ASSESMENT KNOWLEDGE</div>
          <div class="kop-subtitle" id="kopSubtitleView">SMP NEGERI 6 SAMPANG</div>
        </div>
        <table id="tabelNilai">
          <thead>
            <tr>
              <th>Nama</th>
              <th>Kelas</th>
              <th>Predikat</th>
              <th>Score</th>
              <th>Status</th>
              <th>Detail</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Detail jawaban per siswa -->
      <div class="mt-3 hidden" id="detailJawaban">
        <h4>Detail Jawaban Siswa</h4>
        <p style="font-size:13px;">
          <b>Nama:</b> <span id="detailNama"></span> |
          <b>Kelas:</b> <span id="detailKelas"></span> |
          <b>Kode Ujian:</b> <span id="detailKode"></span>
        </p>
        <table id="tabelDetailJawaban">
          <thead>
            <tr>
              <th>No</th>
              <th>Soal</th>
              <th>Jawaban Siswa</th>
              <th>Kunci</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="mt-2">
        <button class="btn btn-primary" id="btnDownloadDaftarNilaiCSV">Download Daftar Nilai (CSV)</button>
        <button class="btn btn-secondary" id="btnPrintDaftarNilaiPDF">Download Daftar Nilai (PDF)</button>
        <button class="btn btn-primary" id="btnMuatNilaiDariDB">Muat Nilai dari Database</button>
      </div>
    </div>
  </section>

  <!-- MODE REKAP TAMPILAN -->
  <section id="sectionRekap" class="section">
    <div class="card">
      <h2>Rekap Nilai (Tampilan)</h2>
      <p style="font-size:13px;">
        Mode ini menampilkan tabel daftar nilai yang sama dengan panel guru.
      </p>
      <div id="rekapClone"></div>
    </div>
  </section>
</main>

<div class="watermark-global">
  Created &amp; Developed by <b>D.D Candra</b>
</div>

<script>
  /* Firebase config */
  const firebaseConfig = {
    apiKey: "AIzaSyD117v_QWb2d2GPXirp7GwmxD_xrHMOy4Y",
    authDomain: "final-assesment-589ad.firebaseapp.com",
    projectId: "final-assesment-589ad",
    storageBucket: "final-assesment-589ad.appspot.com",
    messagingSenderId: "919319444692",
    appId: "1:919319444692:web:99ed966b427684e5e5cf41"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  /* ---- Soal default ---- */
  const defaultSoalList = [
    {
      text: "How are you today?",
      choices: ["I am fine", "No", "Yes", "Fine"],
      correctIndex: 0,
      score: 1
    },
    {
      text: "Bahasa Inggris dari 'sekolah' adalah ....",
      choices: ["Hospital", "Market", "School", "Library"],
      correctIndex: 2,
      score: 1
    }
  ];
  function normalizeSoalList(list) {
    if (!Array.isArray(list) || list.length === 0) list = defaultSoalList;
    return list.map(item => {
      const s = parseFloat(item.score);
      let score = !isNaN(s) && s > 0 ? s : 1;
      return {
        text: item.text || "",
        choices: Array.isArray(item.choices) ? item.choices : ["", "", "", ""],
        correctIndex: typeof item.correctIndex === "number" ? item.correctIndex : 0,
        score
      };
    });
  }
  let soalList = normalizeSoalList(defaultSoalList);
  let soalListForDetail = []; // untuk lihat jawaban siswa (urutan asli guru)

  // Fungsi untuk acak array (Fisherâ€“Yates)
  function shuffleArray(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // Menyimpan urutan soal yang dipakai siswa untuk hasil ujian
  let currentQuestionOrderForResult = [];

  /* ---- State exam untuk simpan hasil ---- */
  let currentExamCodeForResult = null;
  let currentExamOwnerUid = null;
  let currentExamName = null;

  /* ---- Mode & section ---- */
  const btnModeSiswa = document.getElementById("btnModeSiswa");
  const btnModeGuru = document.getElementById("btnModeGuru");
  const btnModeRekap = document.getElementById("btnModeRekap");
  const sectionSiswa = document.getElementById("sectionSiswa");
  const sectionGuruLogin = document.getElementById("sectionGuruLogin");
  const sectionGuruPanel = document.getElementById("sectionGuruPanel");
  const sectionRekap = document.getElementById("sectionRekap");

  function showSectionSiswa() {
    sectionSiswa.classList.add("active");
    sectionGuruLogin.classList.remove("active");
    sectionGuruPanel.classList.remove("active");
    sectionRekap.classList.remove("active");
    btnModeSiswa.classList.add("button_active");
    btnModeGuru.classList.remove("button_active");
    btnModeRekap.classList.remove("button_active");
  }
  function showSectionGuru() {
    sectionSiswa.classList.remove("active");
    if (auth.currentUser) {
      sectionGuruPanel.classList.add("active");
      sectionGuruLogin.classList.remove("active");
    } else {
      sectionGuruLogin.classList.add("active");
      sectionGuruPanel.classList.remove("active");
    }
    sectionRekap.classList.remove("active");
    btnModeSiswa.classList.remove("button_active");
    btnModeGuru.classList.add("button_active");
    btnModeRekap.classList.remove("button_active");
  }
  function showSectionRekap() {
    sectionSiswa.classList.remove("active");
    sectionGuruLogin.classList.remove("active");
    sectionGuruPanel.classList.remove("active");
    sectionRekap.classList.add("active");
    btnModeSiswa.classList.remove("button_active");
    btnModeGuru.classList.remove("button_active");
    btnModeRekap.classList.add("button_active");
    const src = document.getElementById("daftarNilaiArea");
    const dst = document.getElementById("rekapClone");
    dst.innerHTML = "";
    dst.appendChild(src.cloneNode(true));
  }
  btnModeSiswa.addEventListener("click", showSectionSiswa);
  btnModeGuru.addEventListener("click", showSectionGuru);
  btnModeRekap.addEventListener("click", showSectionRekap);

  /* ---- Login guru ---- */
  const btnLoginGuru = document.getElementById("btnLoginGuru");
  const loginError = document.getElementById("loginError");
  const btnLogoutGuru = document.getElementById("btnLogoutGuru");
  const adminUserInput = document.getElementById("adminUser");
  const adminPassInput = document.getElementById("adminPass");
  const adminInfoText = document.getElementById("adminInfoText");

  /* ---- Pengaturan ujian ---- */
  const examNameInput = document.getElementById("examNameInput");
  const examCodeInput = document.getElementById("examCodeInput");
  const examDurationInput = document.getElementById("examDurationInput");
  const btnSimpanUjian = document.getElementById("btnSimpanUjian");
  const btnLoadExamDb = document.getElementById("btnLoadExamDb");
  const btnSaveExamDb = document.getElementById("btnSaveExamDb");
  const examNameViewSiswa = document.getElementById("examNameViewSiswa");
  const examDurationViewSiswa = document.getElementById("examDurationViewSiswa");
  const shuffleQuestionsCheckbox = document.getElementById("shuffleQuestionsCheckbox");

  function loadExamSettingsFromStorage() {
    const name = localStorage.getItem("examName") || "Ujian Contoh";
    const code = localStorage.getItem("examCode") || "1234";
    const duration = localStorage.getItem("examDuration") || "60";
    const shuffleFlag = localStorage.getItem("shuffleQuestions"); // "true"/"false"/null

    examNameInput.value = name;
    examCodeInput.value = code;
    examDurationInput.value = duration;
    examNameViewSiswa.textContent = name;
    examDurationViewSiswa.textContent = duration;

    // default kalau belum pernah diset: true (diacak)
    shuffleQuestionsCheckbox.checked = (shuffleFlag === null ? true : shuffleFlag === "true");
  }
  function getExamSettings() {
    let name = examNameInput.value.trim() || localStorage.getItem("examName") || "Ujian Contoh";
    let code = examCodeInput.value.trim() || localStorage.getItem("examCode") || "1234";
    let duration = parseInt(examDurationInput.value, 10);
    if (isNaN(duration) || duration <= 0) {
      duration = parseInt(localStorage.getItem("examDuration") || "60", 10);
    }
    if (isNaN(duration) || duration <= 0) duration = 60;
    let shuffleQuestions = shuffleQuestionsCheckbox.checked;
    return { name, code, duration, shuffleQuestions };
  }
  btnSimpanUjian.addEventListener("click", () => {
    const { name, code, duration, shuffleQuestions } = getExamSettings();
    localStorage.setItem("examName", name);
    localStorage.setItem("examCode", code);
    localStorage.setItem("examDuration", String(duration));
    localStorage.setItem("shuffleQuestions", String(shuffleQuestions));
    examNameViewSiswa.textContent = name;
    examDurationViewSiswa.textContent = duration;
    alert("Pengaturan ujian disimpan di browser. Klik 'Simpan Ujian + Soal ke Database' untuk mengirim ke Firestore.");
  });

  btnSaveExamDb.addEventListener("click", async () => {
    const { name, code, duration, shuffleQuestions } = getExamSettings();
    if (!name || !code) {
      alert("Nama ujian dan kode ujian wajib diisi.");
      return;
    }
    const user = auth.currentUser;
    if (!user) {
      alert("Guru belum login.");
      return;
    }
    const data = {
      name,
      code,
      duration,
      shuffleQuestions,          // disimpan di Firestore
      soalList,
      ownerUid: user.uid,
      ownerEmail: user.email || ""
    };
    try {
      await db.collection("exams").doc(code).set(data);
      alert("Ujian & bank soal berhasil disimpan ke Firestore dengan kode: " + code);
    } catch (e) {
      console.error(e);
      alert("Gagal menyimpan ke database. Periksa rules Firestore.");
    }
  });

  btnLoadExamDb.addEventListener("click", async () => {
    const code = examCodeInput.value.trim();
    if (!code) {
      alert("Isi kode ujian terlebih dahulu.");
      return;
    }
    try {
      const docSnap = await db.collection("exams").doc(code).get();
      if (!docSnap.exists) {
        alert("Ujian dengan kode tersebut tidak ditemukan.");
        return;
      }
      const data = docSnap.data();
      examNameInput.value = data.name || "";
      examDurationInput.value = data.duration || 60;
      examNameViewSiswa.textContent = data.name || "";
      examDurationViewSiswa.textContent = data.duration || 0;
      soalList = normalizeSoalList(data.soalList || []);
      soalListForDetail = soalList.slice();
      renderTabelSoal();

      if (typeof data.shuffleQuestions === "boolean") {
        shuffleQuestionsCheckbox.checked = data.shuffleQuestions;
      } else {
        shuffleQuestionsCheckbox.checked = true;
      }

      alert("Ujian & bank soal berhasil dimuat dari Firestore.");
    } catch (e) {
      console.error(e);
      alert("Gagal mengambil dari Firestore.");
    }
  });

  /* ---- Header & kop ---- */
  const headerSubtitleInput = document.getElementById("headerSubtitleInput");
  const btnSimpanHeader = document.getElementById("btnSimpanHeader");
  btnSimpanHeader.addEventListener("click", () => {
    const text = headerSubtitleInput.value.trim();
    localStorage.setItem("headerSubtitle", text);
    document.getElementById("headerSubtitle").textContent =
      text || "Final Assessment Ujian Online";
    alert("Header berhasil disimpan.");
  });
  function loadHeaderSubtitleFromStorage() {
    const text = localStorage.getItem("headerSubtitle") || "Final Assessment Ujian Online";
    headerSubtitleInput.value = text;
    document.getElementById("headerSubtitle").textContent = text;
  }

  const kopTitleInput = document.getElementById("kopTitle");
  const kopSubtitleInput = document.getElementById("kopSubtitle");
  const btnSimpanKop = document.getElementById("btnSimpanKop");
  const kopTitleView = document.getElementById("kopTitleView");
  const kopSubtitleView = document.getElementById("kopSubtitleView");
  btnSimpanKop.addEventListener("click", () => {
    const t = kopTitleInput.value.trim();
    const s = kopSubtitleInput.value.trim();
    localStorage.setItem("kopTitle", t);
    localStorage.setItem("kopSubtitle", s);
    kopTitleView.textContent = t || "DAFTAR NILAI SISWA ASSESMENT KNOWLEDGE";
    kopSubtitleView.textContent = s || "SMP NEGERI 6 SAMPANG";
    alert("Kop berhasil disimpan.");
  });
  function loadKopFromStorage() {
    const t = localStorage.getItem("kopTitle") || "DAFTAR NILAI SISWA ASSESMENT KNOWLEDGE";
    const s = localStorage.getItem("kopSubtitle") || "SMP NEGERI 6 SAMPANG";
    kopTitleInput.value = t;
    kopSubtitleInput.value = s;
    kopTitleView.textContent = t;
    kopSubtitleView.textContent = s;
  }

  /* ---- Kelola soal guru ---- */
  const soalText = document.getElementById("soalText");
  const pilihan1 = document.getElementById("pilihan1");
  const pilihan2 = document.getElementById("pilihan2");
  const pilihan3 = document.getElementById("pilihan3");
  const pilihan4 = document.getElementById("pilihan4");
  const jawabanBenar = document.getElementById("jawabanBenar");
  const skorSoal = document.getElementById("skorSoal");
  const btnSimpanSoal = document.getElementById("btnSimpanSoal");
  const btnBatalEdit = document.getElementById("btnBatalEdit");
  const tabelSoalBody = document.querySelector("#tabelSoal tbody");
  const editIndexInput = document.getElementById("editIndex");
  const formSoalTitle = document.getElementById("formSoalTitle");

  function resetFormSoal() {
    editIndexInput.value = "-1";
    formSoalTitle.textContent = "Tambah Soal Baru";
    soalText.value = "";
    pilihan1.value = "";
    pilihan2.value = "";
    pilihan3.value = "";
    pilihan4.value = "";
    jawabanBenar.value = "0";
    skorSoal.value = "1";
    btnBatalEdit.classList.add("hidden");
  }
  function renderTabelSoal() {
    tabelSoalBody.innerHTML = "";
    soalList.forEach((s, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${s.text}</td>
        <td>${s.score}</td>
        <td>
          <button class="btn btn-secondary btn-sm" data-idx="${i}" data-act="edit">Edit</button>
          <button class="btn btn-danger btn-sm" data-idx="${i}" data-act="del">Hapus</button>
        </td>
      `;
      tabelSoalBody.appendChild(tr);
    });
    tabelSoalBody.querySelectorAll("button").forEach(btn => {
      const idx = parseInt(btn.dataset.idx, 10);
      const act = btn.dataset.act;
      btn.addEventListener("click", () => {
        if (act === "edit") editSoal(idx);
        else if (act === "del") hapusSoal(idx);
      });
    });
  }

  // Reset panel guru ketika ganti akun
  function resetGuruPanelForNewUser() {
    soalList = [];
    renderTabelSoal();
    examNameInput.value = "";
    examCodeInput.value = "";
    examDurationInput.value = "60";
    examNameViewSiswa.textContent = "Belum diatur";
    examDurationViewSiswa.textContent = "0";
    soalListForDetail = [];
    currentQuestionOrderForResult = [];
  }

  function editSoal(index) {
    const s = soalList[index];
    editIndexInput.value = String(index);
    formSoalTitle.textContent = "Edit Soal #" + (index + 1);
    soalText.value = s.text;
    pilihan1.value = s.choices[0] || "";
    pilihan2.value = s.choices[1] || "";
    pilihan3.value = s.choices[2] || "";
    pilihan4.value = s.choices[3] || "";
    jawabanBenar.value = String(s.correctIndex);
    skorSoal.value = s.score;
    btnBatalEdit.classList.remove("hidden");
  }
  function hapusSoal(index) {
    if (!confirm("Hapus soal nomor " + (index + 1) + "?")) return;
    soalList.splice(index, 1);
    renderTabelSoal();
  }
  btnBatalEdit.addEventListener("click", resetFormSoal);
  btnSimpanSoal.addEventListener("click", () => {
    const text = soalText.value.trim();
    const c1 = pilihan1.value.trim();
    const c2 = pilihan2.value.trim();
    const c3 = pilihan3.value.trim();
    const c4 = pilihan4.value.trim();
    const correct = parseInt(jawabanBenar.value, 10);
    const score = parseFloat(skorSoal.value);
    if (!text || !c1 || !c2 || !c3 || !c4) {
      alert("Semua field harus diisi.");
      return;
    }
    if (isNaN(score) || score <= 0) {
      alert("Skor soal harus lebih dari 0.");
      return;
    }
    const newSoal = { text, choices: [c1, c2, c3, c4], correctIndex: correct, score };
    const idx = parseInt(editIndexInput.value, 10);
    if (!isNaN(idx) && idx >= 0) soalList[idx] = newSoal;
    else soalList.push(newSoal);
    soalListForDetail = soalList.slice();
    renderTabelSoal();
    resetFormSoal();
    alert("Soal disimpan. Jika final, klik 'Simpan Ujian + Soal ke Database'.");
  });

  // bank soal JSON
  const btnDownloadBankSoal = document.getElementById("btnDownloadBankSoal");
  const uploadBankSoal = document.getElementById("uploadBankSoal");
  btnDownloadBankSoal.addEventListener("click", () => {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(soalList, null, 2));
    const a = document.createElement("a");
    a.href = dataStr;
    a.download = "bank_soal.json";
    a.click();
  });
  uploadBankSoal.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const parsed = JSON.parse(reader.result);
        soalList = normalizeSoalList(parsed);
        soalListForDetail = soalList.slice();
        renderTabelSoal();
        alert("Bank soal berhasil diimpor.");
      } catch {
        alert("File JSON tidak valid.");
      }
    };
    reader.readAsText(file);
  });

  /* ---- Mode siswa: ujian ---- */
  const siswaNamaInput = document.getElementById("siswaNama");
  const siswaKelasInput = document.getElementById("siswaKelas");
  const siswaExamCodeInput = document.getElementById("siswaExamCode");
  const btnMulaiUjian = document.getElementById("btnMulaiUjian");
  const btnSelesaiUjian = document.getElementById("btnSelesaiUjian");
  const soalContainer = document.getElementById("soalContainer");
  const ujianArea = document.getElementById("ujianArea");
  const hasilArea = document.getElementById("hasilArea");
  const hasilNama = document.getElementById("hasilNama");
  const hasilKelas = document.getElementById("hasilKelas");
  const hasilSkor = document.getElementById("hasilSkor");
  const hasilPredikat = document.getElementById("hasilPredikat");
  const hasilStatus = document.getElementById("hasilStatus");
  const timerArea = document.getElementById("timerArea");
  const timerText = document.getElementById("timerText");
  const peringatanFocus = document.getElementById("peringatanFocus");

  let soalUjianAktif = [];
  let timerInterval = null;
  let sisaDetik = 0;
  let lastPercent = 0;
  let lastPredikatText = "";
  let lastStatusText = "";

  function startTimer(durasiMenit) {
    sisaDetik = durasiMenit * 60;
    timerArea.classList.remove("hidden");
    updateTimerText();
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      sisaDetik--;
      if (sisaDetik <= 0) {
        clearInterval(timerInterval);
        alert("Waktu habis, ujian diselesaikan otomatis.");
        selesaiUjian();
      } else updateTimerText();
    }, 1000);
  }
  function updateTimerText() {
    const m = String(Math.floor(sisaDetik / 60)).padStart(2, "0");
    const s = String(sisaDetik % 60).padStart(2, "0");
    timerText.textContent = `${m}:${s}`;
  }

  function renderSoalUntukSiswa() {
    soalContainer.innerHTML = "";
    soalUjianAktif.forEach((soal, index) => {
      const card = document.createElement("div");
      card.className = "question-card";
      const judul = document.createElement("h4");
      judul.textContent = `Soal ${index + 1}. ${soal.text}`;
      card.appendChild(judul);
      const choicesDiv = document.createElement("div");
      choicesDiv.className = "choices";
      soal.choices.forEach((pilihan, idx) => {
        const chDiv = document.createElement("div");
        chDiv.className = "choice";
        const input = document.createElement("input");
        input.type = "radio";
        input.name = "soal_" + index;
        input.value = idx;
        const label = document.createElement("label");
        label.textContent = pilihan;
        chDiv.appendChild(input);
        chDiv.appendChild(label);
        choicesDiv.appendChild(chDiv);
      });
      card.appendChild(choicesDiv);
      soalContainer.appendChild(card);
    });
  }

  btnMulaiUjian.addEventListener("click", async () => {
    const nama = siswaNamaInput.value.trim();
    const kelas = siswaKelasInput.value.trim();
    const kode = siswaExamCodeInput.value.trim();
    if (!nama || !kelas || !kode) {
      alert("Nama, kelas, dan kode ujian wajib diisi.");
      return;
    }
    try {
      const docSnap = await db.collection("exams").doc(kode).get();
      if (!docSnap.exists) {
        alert("Kode ujian tidak ditemukan di database.");
        return;
      }
      const data = docSnap.data();
      examNameViewSiswa.textContent = data.name || "Ujian";
      examDurationViewSiswa.textContent = data.duration || 0;

      // simpan info untuk hasil
      currentExamCodeForResult = kode;
      currentExamOwnerUid = data.ownerUid || null;
      currentExamName = data.name || "";

      const baseSoal = normalizeSoalList(data.soalList || []);

      // baca pengaturan acak soal dari Firestore, default = true
      const shuffleQuestions =
        (typeof data.shuffleQuestions === "boolean") ? data.shuffleQuestions : true;

      if (shuffleQuestions) {
        const order = shuffleArray(baseSoal.map((_, idx) => idx));
        currentQuestionOrderForResult = order;
        soalUjianAktif = order.map(i => baseSoal[i]);
      } else {
        currentQuestionOrderForResult = baseSoal.map((_, idx) => idx);
        soalUjianAktif = baseSoal.slice();
      }

      soalListForDetail = baseSoal.slice(); // untuk detail jawaban

      if (soalUjianAktif.length === 0) {
        alert("Belum ada soal pada ujian ini.");
        return;
      }
      ujianArea.classList.remove("hidden");
      hasilArea.classList.add("hidden");
      renderSoalUntukSiswa();
      startTimer(data.duration || 60);
      window.onblur = () => {
        peringatanFocus.classList.remove("hidden");
      };
    } catch (e) {
      console.error(e);
      alert("Gagal mengambil ujian dari database.");
    }
  });

  btnSelesaiUjian.addEventListener("click", () => {
    if (!confirm("Selesaikan ujian sekarang?")) return;
    selesaiUjian();
  });

  // simpan hasil ke Firestore (dengan answers + questionOrder)
  async function simpanHasilKeFirestore(
    nama, kelas, persen, totalScore, maxScore, predikat, status, answers, questionOrder
  ) {
    try {
      if (!currentExamCodeForResult) return;
      await db.collection("results").add({
        examCode: currentExamCodeForResult,
        examName: currentExamName || "",
        ownerUid: currentExamOwnerUid || null,
        studentName: nama,
        studentClass: kelas,
        percent: persen,
        rawScore: totalScore,
        maxScore: maxScore,
        predikat: predikat,
        status: status,
        answers: answers || [],
        questionOrder: questionOrder || [],
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    } catch (err) {
      console.error("Gagal simpan hasil ke Firestore:", err);
    }
  }

  function selesaiUjian() {
    window.onblur = null;
    if (timerInterval) clearInterval(timerInterval);
    timerArea.classList.add("hidden");

    const nama = siswaNamaInput.value.trim();
    const kelas = siswaKelasInput.value.trim();
    let totalScore = 0;
    let maxScore = 0;
    let answers = [];

    soalUjianAktif.forEach((soal, index) => {
      maxScore += soal.score;
      const radios = document.querySelectorAll(`input[name="soal_${index}"]`);
      let jawaban = -1;
      radios.forEach(r => { if (r.checked) jawaban = parseInt(r.value, 10); });
      answers.push(jawaban);
      if (jawaban === soal.correctIndex) totalScore += soal.score;
    });

    const persen = maxScore > 0 ? Math.round((totalScore / maxScore) * 100) : 0;
    let predikat = "Buruk";
    if (persen >= 90) predikat = "Sangat Bagus";
    else if (persen >= 75) predikat = "Bagus";
    else if (persen >= 60) predikat = "Cukup";
    const status = persen >= 70 ? "Tuntas" : "Remidi";

    lastPercent = persen;
    lastPredikatText = predikat;
    lastStatusText = status;

    simpanHasilKeFirestore(
      nama, kelas, persen, totalScore, maxScore, predikat, status,
      answers,
      currentQuestionOrderForResult
    );

    hasilNama.textContent = nama;
    hasilKelas.textContent = kelas;
    hasilSkor.textContent = `${persen} (Skor ${totalScore} dari ${maxScore})`;
    hasilPredikat.textContent = predikat;
    hasilStatus.textContent = status;

    ujianArea.classList.add("hidden");
    hasilArea.classList.remove("hidden");
  }

  // Download nilai siswa -> CSV
  const btnDownloadNilai = document.getElementById("btnDownloadNilai");
  btnDownloadNilai.addEventListener("click", () => {
    const rows = [
      ["Nama", "Kelas", "Predikat", "Score", "Status"],
      [
        hasilNama.textContent,
        hasilKelas.textContent,
        lastPredikatText,
        lastPercent,
        lastStatusText
      ]
    ];
    const csvContent = rows
      .map(r => r.map(v => `"${String(v).replace(/"/g, '""')}"`).join(","))
      .join("\r\n");
    const a = document.createElement("a");
    a.href = "data:text/csv;charset=utf-8," + encodeURIComponent(csvContent);
    a.download = "nilai_" + (hasilNama.textContent || "siswa") + ".csv";
    a.click();
  });

  /* ---- Rekap nilai ---- */
  const fileNilai = document.getElementById("fileNilai");
  const btnTampilkanDaftarSiswa = document.getElementById("btnTampilkanDaftarSiswa");
  const tabelNilaiBody = document.querySelector("#tabelNilai tbody");
  const filterNama = document.getElementById("filterNama");
  const filterKelas = document.getElementById("filterKelas");
  const btnDownloadDaftarNilaiCSV = document.getElementById("btnDownloadDaftarNilaiCSV");
  const btnPrintDaftarNilaiPDF = document.getElementById("btnPrintDaftarNilaiPDF");
  const btnMuatNilaiDariDB = document.getElementById("btnMuatNilaiDariDB");
  let dataNilai = [];

  const detailJawabanDiv = document.getElementById("detailJawaban");
  const detailNamaSpan = document.getElementById("detailNama");
  const detailKelasSpan = document.getElementById("detailKelas");
  const detailKodeSpan = document.getElementById("detailKode");
  const detailTabelBody = document.querySelector("#tabelDetailJawaban tbody");

  function showDetailJawaban(index) {
    const row = dataNilai[index];
    if (!row) return;
    const { code } = getExamSettings();

    if (!row.answers || !Array.isArray(row.answers) || row.answers.length === 0) {
      alert("Detail jawaban tidak tersedia.\nKemungkinan hasil lama (sebelum fitur ini) atau data dari CSV.");
      return;
    }
    if (!soalListForDetail || soalListForDetail.length === 0) {
      alert("Soal ujian belum dimuat.\nPastikan ujian dengan kode ini sudah memiliki soal di database.");
      return;
    }

    detailNamaSpan.textContent = row.nama || "";
    detailKelasSpan.textContent = row.kelas || "";
    detailKodeSpan.textContent = code || "";

    detailTabelBody.innerHTML = "";

    const order = (Array.isArray(row.questionOrder) && row.questionOrder.length === row.answers.length)
      ? row.questionOrder
      : row.answers.map((_, idx) => idx);

    row.answers.forEach((ans, i) => {
      const originalIndex = order[i] ?? i;
      const soal = soalListForDetail[originalIndex];
      if (!soal) return;

      const qText = soal.text || ("Soal #" + (originalIndex + 1));
      const correctIdx = typeof soal.correctIndex === "number" ? soal.correctIndex : 0;
      const correctText = soal.choices && soal.choices[correctIdx] ? soal.choices[correctIdx] : "-";

      let chosenText = "-";
      let statusText = "Tidak dijawab";
      if (typeof ans === "number" && ans >= 0 && soal.choices && soal.choices[ans]) {
        chosenText = soal.choices[ans];
        statusText = (ans === correctIdx) ? "Benar" : "Salah";
      }

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${qText}</td>
        <td>${chosenText}</td>
        <td>${correctText}</td>
        <td>${statusText}</td>
      `;
      detailTabelBody.appendChild(tr);
    });

    detailJawabanDiv.classList.remove("hidden");
    detailJawabanDiv.scrollIntoView({ behavior: "smooth", block: "start" });
  }

  function applyFilterNilai() {
    const fNama = filterNama.value.trim().toLowerCase();
    const fKelas = filterKelas.value.trim().toLowerCase();
    tabelNilaiBody.innerHTML = "";
    dataNilai.forEach((row, idx) => {
      if (fNama && !row.nama.toLowerCase().includes(fNama)) return;
      if (fKelas && !row.kelas.toLowerCase().includes(fKelas)) return;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.nama}</td>
        <td>${row.kelas}</td>
        <td>${row.predikat}</td>
        <td>${row.score}</td>
        <td>${row.status}</td>
        <td><button class="btn btn-secondary btn-sm" data-idx="${idx}">Lihat</button></td>
      `;
      tabelNilaiBody.appendChild(tr);
    });

    tabelNilaiBody.querySelectorAll("button[data-idx]").forEach(btn => {
      btn.addEventListener("click", () => {
        const i = parseInt(btn.dataset.idx, 10);
        showDetailJawaban(i);
      });
    });
  }
  filterNama.addEventListener("input", applyFilterNilai);
  filterKelas.addEventListener("input", applyFilterNilai);

  // dari CSV
  btnTampilkanDaftarSiswa.addEventListener("click", () => {
    const file = fileNilai.files && fileNilai.files[0];
    if (!file) {
      alert("Pilih file CSV terlebih dahulu.");
      return;
    }
    const reader = new FileReader();
    reader.onload = () => {
      const text = reader.result;
      const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
      if (lines.length <= 1) {
        alert("File CSV kosong atau tidak ada data.");
        return;
      }
      const newData = [];
      for (let i = 1; i < lines.length; i++) {
        const cols = lines[i].split(",");
        if (cols.length < 5) continue;
        const nama = cols[0].replace(/(^"|"$)/g, "").trim();
        const kelas = cols[1].replace(/(^"|"$)/g, "").trim();
        const predikat = cols[2].replace(/(^"|"$)/g, "").trim();
        const score = cols[3].replace(/(^"|"$)/g, "").trim();
        const status = cols[4].replace(/(^"|"$)/g, "").trim();
        if (!nama) continue;
        newData.push({ nama, kelas, predikat, score, status, answers: [], questionOrder: null });
      }
      dataNilai = dataNilai.concat(newData);
      applyFilterNilai();
      alert("Data nilai siswa dari CSV berhasil ditambahkan.");
    };
    reader.readAsText(file);
  });

  // download rekap CSV
  btnDownloadDaftarNilaiCSV.addEventListener("click", () => {
    if (dataNilai.length === 0) {
      alert("Belum ada data nilai.");
      return;
    }
    const header = ["Nama", "Kelas", "Predikat", "Score", "Status"];
    const rows = [header].concat(
      dataNilai.map(r => [r.nama, r.kelas, r.predikat, r.score, r.status])
    );
    const csvContent = rows
      .map(r => r.map(v => `"${String(v).replace(/"/g, '""')}"`).join(","))
      .join("\r\n");
    const a = document.createElement("a");
    a.href = "data:text/csv;charset=utf-8," + encodeURIComponent(csvContent);
    a.download = "daftar_nilai_siswa.csv";
    a.click();
  });

  // download PDF
  btnPrintDaftarNilaiPDF.addEventListener("click", () => {
    if (dataNilai.length === 0) {
      alert("Belum ada data nilai untuk dicetak.");
      return;
    }
    window.print();
  });

  // muat nilai otomatis dari Firestore
  btnMuatNilaiDariDB.addEventListener("click", async () => {
    const { code } = getExamSettings();
    const user = auth.currentUser;

    if (!code) {
      alert("Isi kode ujian di Pengaturan Ujian terlebih dahulu.");
      return;
    }
    if (!user) {
      alert("Guru belum login.");
      return;
    }

    try {
      // muat soal untuk detail juga
      try {
        const examDoc = await db.collection("exams").doc(code).get();
        if (examDoc.exists) {
          const exData = examDoc.data();
          soalListForDetail = normalizeSoalList(exData.soalList || []);
        }
      } catch (e) {
        console.error("Gagal memuat soal untuk detail:", e);
      }

      const snap = await db.collection("results")
        .where("examCode", "==", code)
        .where("ownerUid", "==", user.uid)
        .get();

      const newData = [];
      snap.forEach(doc => {
        const d = doc.data();
        newData.push({
          nama: d.studentName || "",
          kelas: d.studentClass || "",
          predikat: d.predikat || "",
          score: typeof d.percent === "number" ? d.percent : "",
          status: d.status || "",
          answers: Array.isArray(d.answers) ? d.answers : [],
          questionOrder: Array.isArray(d.questionOrder) ? d.questionOrder : null
        });
      });

      dataNilai = newData;
      applyFilterNilai();

      if (newData.length === 0) {
        alert("Belum ada hasil siswa di database untuk kode ujian ini.");
      } else {
        alert("Nilai siswa berhasil dimuat dari database.");
      }
    } catch (err) {
      console.error("Error saat memuat nilai:", err);
      alert("Gagal memuat nilai dari database.");
    }
  });

  /* ---- Login / Logout guru ---- */

  btnLoginGuru.addEventListener("click", async () => {
    const email = adminUserInput.value.trim();
    const pass = adminPassInput.value.trim();
    if (!email || !pass) {
      loginError.textContent = "Email dan password wajib diisi.";
      loginError.classList.remove("hidden");
      return;
    }
    try {
      await auth.signInWithEmailAndPassword(email, pass);
      loginError.classList.add("hidden");
      adminUserInput.value = "";
      adminPassInput.value = "";

      resetGuruPanelForNewUser();
      loadExamSettingsFromStorage();
      loadHeaderSubtitleFromStorage();
      loadKopFromStorage();
      showSectionGuru();
    } catch (err) {
      console.error(err);
      let msg = "Login gagal. ";
      if (err.code === "auth/user-not-found") msg += "Akun tidak ditemukan.";
      else if (err.code === "auth/wrong-password") msg += "Password salah.";
      else msg += err.message;
      loginError.textContent = msg;
      loginError.classList.remove("hidden");
    }
  });

  btnLogoutGuru.addEventListener("click", async () => {
    try { await auth.signOut(); } catch (e) {}
    showSectionSiswa();
  });

  auth.onAuthStateChanged(user => {
    if (user) {
      adminInfoText.textContent = "Login sebagai: " + (user.email || "(tanpa email)");
      resetGuruPanelForNewUser();
      loadExamSettingsFromStorage();
      loadHeaderSubtitleFromStorage();
      loadKopFromStorage();
    } else {
      adminInfoText.textContent = "Belum login.";
    }
  });

  /* ---- Init ---- */
  window.addEventListener("load", () => {
    loadExamSettingsFromStorage();
    loadHeaderSubtitleFromStorage();
    loadKopFromStorage();
    renderTabelSoal();
    showSectionSiswa();
  });
</script>
</body>
</html>
